
{% extends "tournaments/base.html" %}
{% block title %}Tournament Signup{% endblock %}

{% block content %}
<h2>Tournament Signup</h2>
<table class="table table-striped">
    <thead>
        <tr>
            <th>Name</th>
            <th>Date</th>
            <th>Location</th>
            <th>Signup Deadline</th>
            <th>Signup</th>
        </tr>
    </thead>
    <tbody>
        {% for tournament in tournaments %}
        <tr>
            <td>{{ tournament.name }}</td>
            <td>{{ tournament.date.strftime('%B %d, %Y %I:%M %p') if tournament.date else '' }}</td>
            <td>{{ tournament.address }}</td>
            <td>{{ tournament.signup_deadline.strftime('%B %d, %Y %I:%M %p') if tournament.signup_deadline else '' }}
                {% if tournament.signup_deadline and tournament.signup_deadline < now %}<span class="text-danger"> (Closed)</span>{% endif %}
            </td>
            <td>
                {% if tournament.signup_deadline and tournament.signup_deadline < now %}
                    <button class="btn btn-secondary" disabled>Signup Closed</button>
                {% else %}
                    <form method="GET" style="display:inline;">
                        <input type="hidden" name="tournament_id" value="{{ tournament.id }}">
                        <button type="submit" class="btn btn-primary">Signup</button>
                    </form>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% if selected_tournament %}
<h3>Signup for {{ selected_tournament.name }}</h3>
<form method="POST">
    <input type="hidden" name="tournament_id" value="{{ selected_tournament.id }}">
    {% for field in fields %}
    <div class="form-group">
        <label>{{ field.label }} {% if field.required %}*{% endif %}</label>
        {% if field.type == 'text' %}
            <input type="text" name="field_{{ field.id }}" {% if field.required %}required{% endif %}>
        {% elif field.type == 'radio' %}
            {% if field.options %}
                {% for opt in field.options.split(',') %}
                <label>
                    <input type="radio" name="field_{{ field.id }}" value="{{ opt.strip() }}" {% if loop.first and field.required %}required{% endif %}>
                    {{ opt.strip() }}
                </label>
                {% endfor %}
            {% else %}
                <p class="error">No options available for this field.</p>
            {% endif %}
        {% elif field.type == 'dropdown' %}
            {% if field.options %}
                <select name="field_{{ field.id }}" {% if field.required %}required{% endif %}>
                    {% for opt in field.options.split(',') %}
                    <option value="{{ opt.strip() }}">{{ opt.strip() }}</option>
                    {% endfor %}
                </select>
            {% else %}
                <p class="error">No options available for this field.</p>
            {% endif %}
        {% elif field.type == 'checkbox' %}
            {% if field.options %}
                {% for opt in field.options.split(',') %}
                <label>
                    <input type="checkbox" name="field_{{ field.id }}" value="{{ opt.strip() }}">
                    {{ opt.strip() }}
                </label>
                {% endfor %}
            {% else %}
                <p class="error">No options available for this field.</p>
            {% endif %}
        {% endif %}
    </div>
    {% endfor %}
    <button type="submit">Submit Responses</button>
</form>
{% endif %}
{% endblock %}